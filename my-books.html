<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Books - MyWeb Books</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* My Books Page Specific Styles */
        .my-books-header {
            background: linear-gradient(135deg, #0f1942 0%, #1a2744 100%);
            padding: 40px 0;
            text-align: center;
            border-bottom: 1px solid #1a2744;
        }

        .my-books-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .my-books-header p {
            color: #8892b0;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #e94560;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #8892b0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .reading-goal-card {
            background: #0f1942;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem auto;
            max-width: 500px;
            border: 1px solid #1a2744;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .goal-header h3 {
            font-size: 1rem;
            font-weight: 600;
        }

        .goal-edit-btn {
            background: none;
            border: 1px solid #e94560;
            color: #e94560;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .goal-edit-btn:hover {
            background: #e94560;
            color: #fff;
        }

        .goal-progress {
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 8px;
            background: #1a2744;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #8892b0;
            margin-top: 0.5rem;
        }

        .no-goal {
            text-align: center;
            color: #8892b0;
        }

        .set-goal-btn {
            background: #e94560;
            color: #fff;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 1rem;
            transition: background 0.2s;
        }

        .set-goal-btn:hover {
            background: #ff6b6b;
        }

        .section-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid #1a2744;
            padding-bottom: 1rem;
        }

        .tab-btn {
            background: none;
            border: none;
            color: #8892b0;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            color: #fff;
            background: #1a2744;
        }

        .tab-btn.active {
            color: #e94560;
            background: rgba(233, 69, 96, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #8892b0;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            color: #fff;
            margin-bottom: 0.5rem;
        }

        .empty-state a {
            color: #e94560;
            text-decoration: none;
        }

        .empty-state a:hover {
            text-decoration: underline;
        }

        .favorites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1.5rem;
        }

        .favorite-card {
            background: #0f1942;
            border-radius: 12px;
            padding: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .favorite-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .favorite-cover {
            aspect-ratio: 2/3;
            border-radius: 6px;
            margin-bottom: 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 1rem 0.5rem;
        }

        .favorite-cover .book-year {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }

        .favorite-cover h4 {
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 0.25rem;
        }

        .favorite-cover .book-author {
            font-size: 0.7rem;
            opacity: 0.8;
            font-style: italic;
        }

        .favorite-actions {
            display: flex;
            gap: 0.5rem;
        }

        .favorite-actions button,
        .favorite-actions a {
            flex: 1;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-read-fav {
            background: #e94560;
            color: #fff;
            border: none;
        }

        .btn-read-fav:hover {
            background: #ff6b6b;
        }

        .btn-remove-fav {
            background: none;
            border: 1px solid #3a4a6c;
            color: #8892b0;
        }

        .btn-remove-fav:hover {
            border-color: #e94560;
            color: #e94560;
        }

        .recently-read-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .recent-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: #0f1942;
            padding: 1rem;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .recent-item:hover {
            background: #1a2744;
        }

        .recent-info {
            flex: 1;
        }

        .recent-info h4 {
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .recent-info p {
            font-size: 0.8rem;
            color: #8892b0;
        }

        .recent-progress {
            font-size: 0.8rem;
            color: #e94560;
        }

        @media (max-width: 768px) {
            .stats-bar {
                gap: 1.5rem;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .favorites-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="index.html" class="logo">MyWeb Books</a>
                <ul class="nav-menu">
                    <li><a href="my-books.html" class="active">My Books</a></li>
                    <li><a href="index.html#books">Browse</a></li>
                </ul>
            </div>
            <div class="nav-right">
                <div class="search-bar">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    <input type="text" placeholder="Search books...">
                </div>
            </div>
        </div>
    </nav>

    <!-- Header Section -->
    <header class="my-books-header">
        <div class="container">
            <h1>My Books</h1>
            <p>Your personal library and reading progress</p>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number" id="favorites-count">0</div>
                    <div class="stat-label">Favorites</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="books-read-count">0</div>
                    <div class="stat-label">Books Read</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="reading-now-count">0</div>
                    <div class="stat-label">Reading Now</div>
                </div>
            </div>

            <!-- Reading Goal -->
            <div class="reading-goal-card" id="goal-card">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="books-section">
        <div class="container">
            <div class="section-tabs">
                <button class="tab-btn active" data-tab="favorites">Favorites</button>
                <button class="tab-btn" data-tab="recently-read">Recently Read</button>
            </div>

            <!-- Favorites Tab -->
            <div class="tab-content" id="favorites-tab">
                <div class="favorites-grid" id="favorites-grid">
                    <!-- Populated by JavaScript -->
                </div>
                <div class="empty-state" id="empty-favorites" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                    <h3>No favorites yet</h3>
                    <p>Start adding books to your favorites from the <a href="index.html">library</a>.</p>
                </div>
            </div>

            <!-- Recently Read Tab -->
            <div class="tab-content" id="recently-read-tab" style="display: none;">
                <div class="recently-read-list" id="recently-read-list">
                    <!-- Populated by JavaScript -->
                </div>
                <div class="empty-state" id="empty-recent" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                    </svg>
                    <h3>No reading history</h3>
                    <p>Start reading a book to track your progress.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 MyWeb Books. All books are public domain from Project Gutenberg.</p>
        </div>
    </footer>

    <script src="js/app.js"></script>
    <script>
        // ========== MY BOOKS PAGE LOGIC ==========

        const { Favorites, ReadingGoals, ReadingProgress } = window.MyWebBooks;

        // Book cover styles mapping
        const coverStyles = {
            'pride_and_prejudice': 'pride-prejudice',
            'frankenstein': 'frankenstein',
            'dracula': 'dracula',
            'great_gatsby': 'gatsby',
            'alice_in_wonderland': 'alice',
            'sherlock_holmes': 'sherlock',
            'moby_dick': 'moby-dick',
            'jane_eyre': 'jane-eyre',
            'wuthering_heights': 'wuthering',
            'crime_and_punishment': 'crime',
            'war_and_peace': 'war-peace',
            'little_women': 'little-women'
        };

        // ========== TABS ==========
        function initTabs() {
            const tabs = document.querySelectorAll('.tab-btn');
            const favoritesTab = document.getElementById('favorites-tab');
            const recentTab = document.getElementById('recently-read-tab');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const tabName = tab.dataset.tab;
                    if (tabName === 'favorites') {
                        favoritesTab.style.display = '';
                        recentTab.style.display = 'none';
                    } else {
                        favoritesTab.style.display = 'none';
                        recentTab.style.display = '';
                    }
                });
            });
        }

        // ========== STATS ==========
        function updateStats() {
            const favorites = Favorites.getAll();
            const goal = ReadingGoals.getCurrentGoal();
            const recentlyRead = ReadingProgress.getRecentlyRead();

            document.getElementById('favorites-count').textContent = favorites.length;
            document.getElementById('books-read-count').textContent = goal.completed;
            document.getElementById('reading-now-count').textContent = recentlyRead.length;
        }

        // ========== READING GOAL ==========
        function renderGoalCard() {
            const goal = ReadingGoals.getCurrentGoal();
            const goalCard = document.getElementById('goal-card');

            if (goal.target === 0) {
                goalCard.innerHTML = `
                    <div class="no-goal">
                        <p>Set a reading goal to track your progress this year</p>
                        <button class="set-goal-btn" onclick="setGoal()">Set Reading Goal</button>
                    </div>
                `;
            } else {
                const progress = ReadingGoals.getProgress();
                goalCard.innerHTML = `
                    <div class="goal-header">
                        <h3>${goal.year} Reading Goal</h3>
                        <button class="goal-edit-btn" onclick="setGoal()">Edit</button>
                    </div>
                    <div class="goal-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <div class="progress-text">
                            <span>${goal.completed} of ${goal.target} books</span>
                            <span>${progress}%</span>
                        </div>
                    </div>
                `;
            }
        }

        function setGoal() {
            ReadingGoals.promptForGoal();
            renderGoalCard();
            updateStats();
        }

        // ========== FAVORITES GRID ==========
        function renderFavorites() {
            const favorites = Favorites.getAll();
            const grid = document.getElementById('favorites-grid');
            const emptyState = document.getElementById('empty-favorites');

            if (favorites.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = '';
                return;
            }

            grid.style.display = '';
            emptyState.style.display = 'none';

            grid.innerHTML = favorites.map(book => {
                const coverClass = book.coverClass || coverStyles[book.id] || '';
                return `
                    <div class="favorite-card" data-book-id="${book.id}">
                        <div class="favorite-cover book-cover ${coverClass}">
                            <span class="book-year">${book.year || ''}</span>
                            <h4>${book.title}</h4>
                            <p class="book-author">${book.author || ''}</p>
                        </div>
                        <div class="favorite-actions">
                            <a href="${book.readerUrl || '#'}" class="btn-read-fav">Read</a>
                            <button class="btn-remove-fav" onclick="removeFavorite('${book.id}')">Remove</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function removeFavorite(bookId) {
            Favorites.remove(bookId);
            renderFavorites();
            updateStats();
        }

        // ========== RECENTLY READ ==========
        function renderRecentlyRead() {
            const recent = ReadingProgress.getRecentlyRead(10);
            const list = document.getElementById('recently-read-list');
            const emptyState = document.getElementById('empty-recent');

            if (recent.length === 0) {
                list.style.display = 'none';
                emptyState.style.display = '';
                return;
            }

            list.style.display = '';
            emptyState.style.display = 'none';

            list.innerHTML = recent.map(item => {
                const date = new Date(item.lastRead).toLocaleDateString();
                const progress = item.totalPages > 0
                    ? `Page ${item.page} of ${item.totalPages}`
                    : `Page ${item.page}`;

                // Format the book slug to a title
                const title = item.slug.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

                return `
                    <div class="recent-item">
                        <div class="recent-info">
                            <h4>${title}</h4>
                            <p>Last read: ${date}</p>
                        </div>
                        <div class="recent-progress">${progress}</div>
                        <a href="reader.html?book=${item.slug}&title=${encodeURIComponent(title)}" class="btn-read-fav">Continue</a>
                    </div>
                `;
            }).join('');
        }

        // ========== INITIALIZE ==========
        document.addEventListener('DOMContentLoaded', () => {
            initTabs();
            updateStats();
            renderGoalCard();
            renderFavorites();
            renderRecentlyRead();

            // Listen for changes
            window.addEventListener('favoritesChanged', () => {
                renderFavorites();
                updateStats();
            });

            window.addEventListener('readingGoalChanged', () => {
                renderGoalCard();
                updateStats();
            });
        });
    </script>
</body>
</html>
